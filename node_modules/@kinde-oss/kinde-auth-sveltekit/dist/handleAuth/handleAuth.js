import { kindeAuthClient } from '../KindeSDK.js';
import { kindeConfiguration } from '../index.js';
import { parseSearchParamsToObject } from '../utils/index.js';
import { error, redirect } from '@sveltejs/kit';
export async function handleAuth({ request, params, url: originURL }) {
    const options = parseSearchParamsToObject(originURL.search);
    let url = null;
    switch (params.kindeAuth) {
        case 'login':
            url = await kindeAuthClient.login(request, options);
            break;
        case 'register':
            url = await kindeAuthClient.register(request, options);
            break;
        case 'create_org':
            url = await kindeAuthClient.createOrg(request, options);
            break;
        case 'kinde_callback':
            await kindeAuthClient.handleRedirectToApp(request, new URL(request.url));
            throw redirect(302, kindeConfiguration.loginRedirectURL ?? '/');
        case 'logout':
            url = await kindeAuthClient.logout(request);
            break;
        default:
            throw error(404, 'Not Found');
    }
    throw redirect(302, url.toString());
}
